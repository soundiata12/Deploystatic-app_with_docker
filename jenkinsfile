pipeline{
    agent any
        parameters {
            string(name: 'IMAGETAG', defaultValue: '1.0.3')
        }
        environment{
            MYCRE_ID= 'ecr:us-east-1:My-static-app'
            FULL_REPO_URL= 'https://646617499701.dkr.ecr.us-east-1.amazonaws.com/'
            MY_URL = '646617499701.dkr.ecr.us-east-1.amazonaws.com/'
            MYAPP_NAME= 'My-static-app'
        }

    
    stages{
    
        stage("build image5"){
            steps{
                script{
                    // This step should not normally be used in your script. Consult the inline help for details.
                      withDockerRegistry(credentialsId: '7033ed97-cf04-4e9d-ae5d-e4b878c8067b') {
                       sh "docker build -t app:${params.IMAGETAG} ."
                       sh "docker tag app:${params.IMAGETAG} soundiata87/app:${params.IMAGETAG}"
                       sh "docker push soundiata87/app:${params.IMAGETAG}"
                       //sh "docker rmi app:1.0.3"//
                }
             }
            }
        }
        stage("Build and push ECR"){
            steps{
                script{
                    // This step should not normally be used in your script. Consult the inline help for details.
                    withDockerRegistry(credentialsId: ${MYCRED_ID}, url: ${params.FULL-REPO_URL}) {
                        sh "docker build -t my-static-app:${params.IMAGETAG } ." 
                        sh "docker tag my-static-app:${params.IMAGETAG} ${MY_URL}/${MYAPP_NAME}:${params.IMAGETAG} "
                        sh "docker tag my-static-app:${params.IMAGETAG} ${MY_URL}/${MYAPP_NAME}:latest"
                        sh "docker push ${MY_URL}/${MYAPP_NAME}:latest"
                        sh "docker push ${MY_URL}/${MYAPP_NAME}:${params.IMAGETAG}"
                        echo "See if im connected"
                 }
                }
            }
        }
     }
    }

        